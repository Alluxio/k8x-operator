{"ast":null,"code":"import { anchorIsValid } from '../doc/anchors.js';\nimport { visit } from '../visit.js';\nimport { ALIAS, isAlias, isCollection, isPair } from './identity.js';\nimport { NodeBase } from './Node.js';\nimport { toJS } from './toJS.js';\nclass Alias extends NodeBase {\n  constructor(source) {\n    super(ALIAS);\n    this.source = source;\n    Object.defineProperty(this, 'tag', {\n      set() {\n        throw new Error('Alias nodes cannot have tags');\n      }\n    });\n  }\n  /**\n   * Resolve the value of this alias within `doc`, finding the last\n   * instance of the `source` anchor before this node.\n   */\n  resolve(doc) {\n    let found = undefined;\n    visit(doc, {\n      Node: (_key, node) => {\n        if (node === this) return visit.BREAK;\n        if (node.anchor === this.source) found = node;\n      }\n    });\n    return found;\n  }\n  toJSON(_arg, ctx) {\n    if (!ctx) return {\n      source: this.source\n    };\n    const {\n      anchors,\n      doc,\n      maxAliasCount\n    } = ctx;\n    const source = this.resolve(doc);\n    if (!source) {\n      const msg = \"Unresolved alias (the anchor must be set before the alias): \".concat(this.source);\n      throw new ReferenceError(msg);\n    }\n    let data = anchors.get(source);\n    if (!data) {\n      // Resolve anchors for Node.prototype.toJS()\n      toJS(source, null, ctx);\n      data = anchors.get(source);\n    }\n    /* istanbul ignore if */\n    if (!data || data.res === undefined) {\n      const msg = 'This should not happen: Alias anchor was not resolved?';\n      throw new ReferenceError(msg);\n    }\n    if (maxAliasCount >= 0) {\n      data.count += 1;\n      if (data.aliasCount === 0) data.aliasCount = getAliasCount(doc, source, anchors);\n      if (data.count * data.aliasCount > maxAliasCount) {\n        const msg = 'Excessive alias count indicates a resource exhaustion attack';\n        throw new ReferenceError(msg);\n      }\n    }\n    return data.res;\n  }\n  toString(ctx, _onComment, _onChompKeep) {\n    const src = \"*\".concat(this.source);\n    if (ctx) {\n      anchorIsValid(this.source);\n      if (ctx.options.verifyAliasOrder && !ctx.anchors.has(this.source)) {\n        const msg = \"Unresolved alias (the anchor must be set before the alias): \".concat(this.source);\n        throw new Error(msg);\n      }\n      if (ctx.implicitKey) return \"\".concat(src, \" \");\n    }\n    return src;\n  }\n}\nfunction getAliasCount(doc, node, anchors) {\n  if (isAlias(node)) {\n    const source = node.resolve(doc);\n    const anchor = anchors && source && anchors.get(source);\n    return anchor ? anchor.count * anchor.aliasCount : 0;\n  } else if (isCollection(node)) {\n    let count = 0;\n    for (const item of node.items) {\n      const c = getAliasCount(doc, item, anchors);\n      if (c > count) count = c;\n    }\n    return count;\n  } else if (isPair(node)) {\n    const kc = getAliasCount(doc, node.key, anchors);\n    const vc = getAliasCount(doc, node.value, anchors);\n    return Math.max(kc, vc);\n  }\n  return 1;\n}\nexport { Alias };","map":{"version":3,"names":["anchorIsValid","visit","ALIAS","isAlias","isCollection","isPair","NodeBase","toJS","Alias","constructor","source","Object","defineProperty","set","Error","resolve","doc","found","undefined","Node","_key","node","BREAK","anchor","toJSON","_arg","ctx","anchors","maxAliasCount","msg","concat","ReferenceError","data","get","res","count","aliasCount","getAliasCount","toString","_onComment","_onChompKeep","src","options","verifyAliasOrder","has","implicitKey","item","items","c","kc","key","vc","value","Math","max"],"sources":["/Users/shoukaiwen/WebstormProjects/alluxio-k8s-operator-ui/node_modules/yaml/browser/dist/nodes/Alias.js"],"sourcesContent":["import { anchorIsValid } from '../doc/anchors.js';\nimport { visit } from '../visit.js';\nimport { ALIAS, isAlias, isCollection, isPair } from './identity.js';\nimport { NodeBase } from './Node.js';\nimport { toJS } from './toJS.js';\n\nclass Alias extends NodeBase {\n    constructor(source) {\n        super(ALIAS);\n        this.source = source;\n        Object.defineProperty(this, 'tag', {\n            set() {\n                throw new Error('Alias nodes cannot have tags');\n            }\n        });\n    }\n    /**\n     * Resolve the value of this alias within `doc`, finding the last\n     * instance of the `source` anchor before this node.\n     */\n    resolve(doc) {\n        let found = undefined;\n        visit(doc, {\n            Node: (_key, node) => {\n                if (node === this)\n                    return visit.BREAK;\n                if (node.anchor === this.source)\n                    found = node;\n            }\n        });\n        return found;\n    }\n    toJSON(_arg, ctx) {\n        if (!ctx)\n            return { source: this.source };\n        const { anchors, doc, maxAliasCount } = ctx;\n        const source = this.resolve(doc);\n        if (!source) {\n            const msg = `Unresolved alias (the anchor must be set before the alias): ${this.source}`;\n            throw new ReferenceError(msg);\n        }\n        let data = anchors.get(source);\n        if (!data) {\n            // Resolve anchors for Node.prototype.toJS()\n            toJS(source, null, ctx);\n            data = anchors.get(source);\n        }\n        /* istanbul ignore if */\n        if (!data || data.res === undefined) {\n            const msg = 'This should not happen: Alias anchor was not resolved?';\n            throw new ReferenceError(msg);\n        }\n        if (maxAliasCount >= 0) {\n            data.count += 1;\n            if (data.aliasCount === 0)\n                data.aliasCount = getAliasCount(doc, source, anchors);\n            if (data.count * data.aliasCount > maxAliasCount) {\n                const msg = 'Excessive alias count indicates a resource exhaustion attack';\n                throw new ReferenceError(msg);\n            }\n        }\n        return data.res;\n    }\n    toString(ctx, _onComment, _onChompKeep) {\n        const src = `*${this.source}`;\n        if (ctx) {\n            anchorIsValid(this.source);\n            if (ctx.options.verifyAliasOrder && !ctx.anchors.has(this.source)) {\n                const msg = `Unresolved alias (the anchor must be set before the alias): ${this.source}`;\n                throw new Error(msg);\n            }\n            if (ctx.implicitKey)\n                return `${src} `;\n        }\n        return src;\n    }\n}\nfunction getAliasCount(doc, node, anchors) {\n    if (isAlias(node)) {\n        const source = node.resolve(doc);\n        const anchor = anchors && source && anchors.get(source);\n        return anchor ? anchor.count * anchor.aliasCount : 0;\n    }\n    else if (isCollection(node)) {\n        let count = 0;\n        for (const item of node.items) {\n            const c = getAliasCount(doc, item, anchors);\n            if (c > count)\n                count = c;\n        }\n        return count;\n    }\n    else if (isPair(node)) {\n        const kc = getAliasCount(doc, node.key, anchors);\n        const vc = getAliasCount(doc, node.value, anchors);\n        return Math.max(kc, vc);\n    }\n    return 1;\n}\n\nexport { Alias };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}